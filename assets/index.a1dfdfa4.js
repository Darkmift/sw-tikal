var k=Object.defineProperty,_=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var A=(e,t,s)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,L=(e,t)=>{for(var s in t||(t={}))U.call(t,s)&&A(e,s,t[s]);if($)for(var s of $(t))Y.call(t,s)&&A(e,s,t[s]);return e},T=(e,t)=>_(e,G(t));import{j as M,r as p,R as B,a as q,L as z,b as Q}from"./vendor.76b51780.js";const X=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const x of n.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&l(x)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}};X();const o=M.exports.jsx,b=M.exports.jsxs,E=M.exports.Fragment;function Z({vehicleWithLargestSum:e}){const[t,s]=p.exports.useState("AT-AT"),[l,r]=p.exports.useState(["Naboo",5e3]),[n,x]=p.exports.useState(["Luke SkyWalker"]);return p.exports.useEffect(()=>{var v,S;const u=e;!((S=(v=u==null?void 0:u.result)==null?void 0:v.properties)==null?void 0:S.name)||!u.totalSum||(s(u.result.properties.name),r(u.planetsInfo.map(w=>({name:w.result.properties.name,population:w.result.properties.population}))),x(u.vehiclePilotsInfo.map(w=>({name:w.result.properties.name}))))},[e]),b("table",{className:"table",children:[o("thead",{children:o("tr",{children:o("th",{colSpan:"2",children:"Table contents"})})}),b("tbody",{children:[b("tr",{children:[o("td",{children:"Vehicle name with largest sum"}),o("td",{children:t})]}),b("tr",{children:[o("td",{children:"Related home planets and their respective population"}),o("td",{children:JSON.stringify(l)})]}),b("tr",{children:[o("td",{children:"Related pilot names"}),o("td",{children:JSON.stringify(n)})]})]})]})}const K=({x:e,y:t,width:s,height:l,labaelName:r,amount:n})=>!t||!l?o(E,{}):(n=+n,b(E,{children:[o("rect",{x:e,y:t,width:s,height:l,fill:"black"}),o("text",{x:e,y:t-5,children:`${r}`}),o("text",{x:e,y:"98%",fontWeight:"bold",fill:"#a02c2c",children:`${n.toLocaleString("en-GB")}`})]}));const ee=B.forwardRef(({children:e,width:t,height:s,emitChartRef:l},r)=>(p.exports.useEffect(()=>{l(r)},[r]),o("svg",{ref:r,viewBox:`0 0 ${t} ${s}`,width:"100%",height:"70%",preserveAspectRatio:"xMidYMax meet",children:e})));function te(e,t,s){let l=t/s*100;const r=e/100;return l<5&&(l=10),l*r}const se=({chartData:e,labaelName:t,amountKey:s})=>{const[l,r]=p.exports.useState(0),[n,x]=p.exports.useState(0),u=p.exports.useRef(null),v=(c,h)=>[...c].sort((m,f)=>f[h]-m[h])[0][h];p.exports.useEffect(()=>{(e==null?void 0:e.length)&&r(v(e,s))},[e]);const S=c=>{x(c.current.clientWidth)},w=l,y=n*.75,C=e.length;let j=n;const i=n/C,a=i/10;return o(E,{children:o(ee,{height:y,width:j,ref:u,emitChartRef:S,children:(e==null?void 0:e.length)&&e.map((c,h)=>{let m=te(y-30,c[s],w);return o(K,{x:h*(i+a),y:y-m,width:i,height:m-30,labaelName:c[t],amount:c[s]},c.name)})})})},re=async e=>{console.log("\u{1F680} ~ file: index.js ~ line 4 ~ apiCall FETCHNIG ~ url",e);try{return(await q.get(e)).data}catch(t){return console.log("\u{1F680} ~ file: index.js ~ line 7 ~ apiCall ~ error",t),[]}};var F=new z("db");F.config.debug=!1;const J="https://www.swapi.tech/api/vehicles/",ne="https://www.swapi.tech/api/planets/";async function H(e,t){try{if(!e||!t)throw"missing args";return await F.collection(e).doc({id:t}).get()}catch(s){return console.log("\u{1F680} ~ file: useFetchData.js ~ line 23 ~ getData ~ error",s),null}}async function oe(e,t,s){try{if(!e||!t||!s)throw"missing args";return await F.collection(e).add(L({id:t},s)),await H(e,t)}catch(l){return console.log("\u{1F680} ~ file: useFetchData.js ~ line 23 ~ getData ~ error",l),null}}async function P(e,t){try{if(!e||!t)throw"missing args";const s=t,l=await H(e,s);if(!l){const r=await re(t);if(r)return await oe(e,s,r)}return l}catch(s){return console.log("\u{1F680} ~ file: useFetchData.js ~ line 42 ~ fetchFromApiOrIndexedDb ~ error",s),null}}const le=()=>{const[e,t]=p.exports.useState([]),[s,l]=p.exports.useState([]),[r,n]=p.exports.useState([]),[x,u]=p.exports.useState({planets:0,vehicles:0}),[v,S]=p.exports.useState(0),[w,y]=p.exports.useState(!1);return p.exports.useEffect(()=>{const C=async i=>{var a,c,h,m,f;try{const g=await P("vehicles",i);if(g.results.length)for(const R of g.results){if(!R.url)continue;const N=await P("vehicles",R.url);if(S(I=>I+=1),(h=(c=(a=N==null?void 0:N.result)==null?void 0:a.properties)==null?void 0:c.pilots)==null?void 0:h.length)for(const I of N.result.properties.pilots){const d=await P("pilots",I);if((f=(m=d==null?void 0:d.result)==null?void 0:m.properties)==null?void 0:f.homeworld){const O=await P("planets",d.result.properties.homeworld)}}}if(g.next)return await C(g.next)}catch(g){console.log("\u{1F680} ~ file: useFetchData.js ~ line 48 ~ seedState ~ error",g)}};(async()=>{try{y(!0);const i=await P("totals",J),a=await P("totals",ne);i.total_records&&u(f=>T(L({},f),{vehicles:i.total_records})),a.total_records&&u(f=>T(L({},f),{planets:a.total_records})),await C(J);const c=await F.collection("vehicles").get(),h=await F.collection("pilots").get(),m=await F.collection("planets").get();t(f=>c),l(f=>h),n(f=>m)}catch(i){console.log("\u{1F680} ~ file: useFetchData.js ~ line 97 ~ seedState ~ error",i)}finally{console.log("\u{1F680} ~ file: useFetchData.js ~ line 116 ~ seedState ~ FINALLY FINISHED FETCHING OR ERROR",!1),y(!1)}})()},[]),{vehiclesData:e,pilotData:s,planetData:r,totals:x,fetchedVehicles:v,loading:w}};function ie(){return o("div",{className:"spinner",children:o("span",{className:"load"})})}function ae(){const{vehiclesData:e,pilotData:t,planetData:s,totals:l,fetchedVehicles:r,loading:n}=le(),x=e.filter(i=>{var a;return(a=i==null?void 0:i.result)==null?void 0:a.uid}),[u,v]=p.exports.useState([]),[S,w]=p.exports.useState({}),y=()=>e.reduce((i,a)=>{var R,N;const c=(N=(R=a==null?void 0:a.result)==null?void 0:R.properties)==null?void 0:N.pilots;if(!(c==null?void 0:c.length))return i;const h=[],m=c.map(I=>{const d=t.find(D=>D.result.properties.url===I);return d&&h.push(d),s.find(D=>{var V,W;return D.result.properties.url===((W=(V=d==null?void 0:d.result)==null?void 0:V.properties)==null?void 0:W.homeworld)})}),f=m.reduce((I,d)=>{var O,D;return I+=+((D=(O=d==null?void 0:d.result)==null?void 0:O.properties)==null?void 0:D.population),I},0),g=JSON.parse(JSON.stringify(a));return g.totalSum=f,g.vehiclePilotsInfo=h,g.planetsInfo=m,i.totalSum||(i=g),g.totalSum>i.totalSum?g:i},{});let C="population",j="name";return p.exports.useEffect(()=>{if(!n&&s.length){let i=JSON.parse(JSON.stringify(s));i=i.map(a=>({name:a.result.properties.name,population:+a.result.properties.population||0})).sort((a,c)=>c.population-a.population),v(i.slice(0,5))}!n&&e.length&&s.length&&t.length&&w(y())},[n]),b("div",{className:"app",children:[o("h1",{children:"Tikal Code Challenge"}),o("h3",{children:n&&x.length!=l.vehicles&&b("span",{children:["fetching vehicles info... \xA0( ",+r||"0","/",l.vehicles,")",o("br",{}),"The first time takes a while..."]})}),n&&o(ie,{}),!n&&S&&o(Z,{vehicleWithLargestSum:S}),!n&&u.length&&b(E,{children:[o("h2",{children:"Top 5 Most Populated Planets"}),o(se,{amountKey:C,labaelName:j,chartData:u})]})]})}Q.render(o(B.StrictMode,{children:o(ae,{})}),document.getElementById("root"));
