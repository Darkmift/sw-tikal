var _=Object.defineProperty,H=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var $=(e,t,r)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,F=(e,t)=>{for(var r in t||(t={}))Y.call(t,r)&&$(e,r,t[r]);if(V)for(var r of V(t))q.call(t,r)&&$(e,r,t[r]);return e},O=(e,t)=>H(e,G(t));import{j as E,r as p,R as A,a as z,L as Q,b as X}from"./vendor.76b51780.js";const Z=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const w of s.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&o(w)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};Z();const i=E.exports.jsx,S=E.exports.jsxs,j=E.exports.Fragment;function K({vehicleWithLargestSum:e}){const[t,r]=p.exports.useState("AT-AT"),[o,n]=p.exports.useState(["Naboo",5e3]),[s,w]=p.exports.useState(["Luke SkyWalker"]);return p.exports.useEffect(()=>{var b,x;const u=e;!((x=(b=u==null?void 0:u.result)==null?void 0:b.properties)==null?void 0:x.name)||!u.totalSum||(r(u.result.properties.name),n(u.planetsInfo.map(v=>({name:v.result.properties.name,population:v.result.properties.population}))),w(u.vehiclePilotsInfo.map(v=>({name:v.result.properties.name}))))},[e]),S("table",{className:"table",children:[i("thead",{children:i("tr",{children:i("th",{colSpan:"2",children:"Table contents"})})}),S("tbody",{children:[S("tr",{children:[i("td",{children:"Vehicle name with largest sum"}),i("td",{children:t})]}),S("tr",{children:[i("td",{children:"Related home planets and their respective population"}),i("td",{children:JSON.stringify(o)})]}),S("tr",{children:[i("td",{children:"Related pilot names"}),i("td",{children:JSON.stringify(s)})]})]})]})}const ee=({x:e,y:t,width:r,height:o,labaelName:n,amount:s})=>!t||!o?i(j,{}):(s=+s,S(j,{children:[i("rect",{x:e,y:t,width:r,height:o,fill:"black"}),i("text",{x:e,y:t-5,children:`${n}`}),i("text",{x:e,y:"98%",fontWeight:"bold",fill:"#a02c2c",children:`${s.toLocaleString("en-GB")}`})]}));const te=A.forwardRef(({children:e,width:t,height:r,emitChartRef:o},n)=>(p.exports.useEffect(()=>{o(n)},[n]),i("svg",{ref:n,viewBox:`0 0 ${t} ${r}`,width:"100%",height:"70%",preserveAspectRatio:"xMidYMax meet",children:e})));function re(e,t,r){let o=t/r*100;const n=e/100;return o<5&&(o=10),o*n}const ne=({chartData:e,labaelName:t,amountKey:r})=>{const[o,n]=p.exports.useState(0),[s,w]=p.exports.useState(0),u=p.exports.useRef(null),b=(c,h)=>[...c].sort((m,f)=>f[h]-m[h])[0][h];p.exports.useEffect(()=>{(e==null?void 0:e.length)&&n(b(e,r))},[e]);const x=c=>{w(c.current.clientWidth)},v=o,y=s*.75,I=e.length;let k=s;const l=s/I,a=l/10;return i(j,{children:i(te,{height:y,width:k,ref:u,emitChartRef:x,children:(e==null?void 0:e.length)&&e.map((c,h)=>{let m=re(y-30,c[r],v);return i(ee,{x:h*(l+a),y:y-m,width:l,height:m-30,labaelName:c[t],amount:c[r]},c.name)})})})},oe=async e=>{console.log("\u{1F680} ~ file: index.js ~ line 4 ~ apiCall FETCHNIG ~ url",e);try{return(await z.get(e)).data}catch(t){return console.log("\u{1F680} ~ file: index.js ~ line 7 ~ apiCall ~ error",t),[]}};var N=new Q("db");N.config.debug=!1;const B="https://www.swapi.tech/api/vehicles/",se="https://www.swapi.tech/api/planets/";async function M(e,t){try{if(!e||!t)throw"missing args";return await N.collection(e).doc({id:t}).get()}catch(r){return console.log("\u{1F680} ~ file: useFetchData.js ~ line 23 ~ getData ~ error",r),null}}async function ie(e,t,r){try{if(!e||!t||!r)throw"missing args";return await N.collection(e).add(F({id:t},r)),await M(e,t)}catch(o){return console.log("\u{1F680} ~ file: useFetchData.js ~ line 23 ~ getData ~ error",o),null}}async function W(e,t){try{if(!e||!t)throw"missing args";const r=t,o=await M(e,r);if(!o){const n=await oe(t);if(n)return await ie(e,r,n)}return o}catch(r){return console.log("\u{1F680} ~ file: useFetchData.js ~ line 42 ~ fetchFromApiOrIndexedDb ~ error",r),null}}const le=()=>{const[e,t]=p.exports.useState([]),[r,o]=p.exports.useState([]),[n,s]=p.exports.useState([]),[w,u]=p.exports.useState({planets:0,vehicles:0}),[b,x]=p.exports.useState(0),[v,y]=p.exports.useState(!1);return p.exports.useEffect(()=>{const I=async l=>{var a,c,h,m,f;try{const g=await W("vehicles",l);if(g.results.length)for(const R of g.results){if(!R.url)continue;const C=await W("vehicles",R.url);if(x(P=>P+=1),(h=(c=(a=C==null?void 0:C.result)==null?void 0:a.properties)==null?void 0:c.pilots)==null?void 0:h.length)for(const P of C.result.properties.pilots){const d=await W("pilots",P);if((f=(m=d==null?void 0:d.result)==null?void 0:m.properties)==null?void 0:f.homeworld){const D=await W("planets",d.result.properties.homeworld)}}}if(g.next)return await I(g.next)}catch(g){console.log("\u{1F680} ~ file: useFetchData.js ~ line 48 ~ seedState ~ error",g)}};(async()=>{try{y(!0);const l=await W("totals",B),a=await W("totals",se);l.total_records&&u(f=>O(F({},f),{vehicles:l.total_records})),a.total_records&&u(f=>O(F({},f),{planets:a.total_records})),await I(B);const c=await N.collection("vehicles").get(),h=await N.collection("pilots").get(),m=await N.collection("planets").get();t(f=>c),o(f=>h),s(f=>m)}catch(l){console.log("\u{1F680} ~ file: useFetchData.js ~ line 97 ~ seedState ~ error",l)}finally{console.log("\u{1F680} ~ file: useFetchData.js ~ line 116 ~ seedState ~ FINALLY FINISHED FETCHING OR ERROR",!1),y(!1)}})()},[]),{vehiclesData:e,pilotData:r,planetData:n,totals:w,fetchedVehicles:b,loading:v}};function ae(){return i("div",{className:"spinner",children:i("span",{className:"load"})})}function ce(){const{vehiclesData:e,pilotData:t,planetData:r,totals:o,fetchedVehicles:n,loading:s}=le(),w=e.filter(l=>{var a;return(a=l==null?void 0:l.result)==null?void 0:a.uid}),[u,b]=p.exports.useState([]),[x,v]=p.exports.useState({}),y=()=>e.reduce((l,a)=>{var R,C;const c=(C=(R=a==null?void 0:a.result)==null?void 0:R.properties)==null?void 0:C.pilots;if(!(c==null?void 0:c.length))return l;const h=[],m=c.map(P=>{const d=t.find(L=>L.result.properties.url===P);return d&&h.push(d),r.find(L=>{var T,U;return L.result.properties.url===((U=(T=d==null?void 0:d.result)==null?void 0:T.properties)==null?void 0:U.homeworld)})}),f=m.reduce((P,d)=>{var D,L;return P+=+((L=(D=d==null?void 0:d.result)==null?void 0:D.properties)==null?void 0:L.population),P},0),g=JSON.parse(JSON.stringify(a));return g.totalSum=f,g.vehiclePilotsInfo=h,g.planetsInfo=m,l.totalSum||(l=g),g.totalSum>l.totalSum?g:l},{});let I="population",k="name";return p.exports.useEffect(()=>{if(!s&&r.length){let l=JSON.parse(JSON.stringify(r));l=l.map(a=>({name:a.result.properties.name,population:+a.result.properties.population||0})).sort((a,c)=>c.population-a.population),b(l.slice(0,5))}!s&&e.length&&r.length&&t.length&&v(y())},[s]),S("div",{className:"app",children:[i("h1",{children:"Tikal Code Challenge"}),i("h3",{children:s&&w.length!=o.vehicles&&S("span",{children:["fetching vehicles info... \xA0( ",+n||"0","/",o.vehicles,")",i("br",{}),"The first time takes a while..."]})}),s&&i(ae,{}),!s&&x&&i(K,{vehicleWithLargestSum:x}),!s&&u.length&&S(j,{children:[i("h2",{children:"Top 5 Most Populated Planets"}),i(ne,{amountKey:I,labaelName:k,chartData:u})]})]})}const pe=Boolean(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ue(e){if("serviceWorker"in navigator){if(new URL({}.PUBLIC_URL,window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const r=`${{}.PUBLIC_URL}/service-worker.js`;pe?(de(r,e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")})):J(r,e)})}}function J(e,t){navigator.serviceWorker.register(e).then(r=>{r.onupdatefound=()=>{const o=r.installing;o!=null&&(o.onstatechange=()=>{o.state==="installed"&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(r)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(r)))})}}).catch(r=>{console.error("Error during service worker registration:",r)})}function de(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then(r=>{const o=r.headers.get("content-type");r.status===404||o!=null&&o.indexOf("javascript")===-1?navigator.serviceWorker.ready.then(n=>{n.unregister().then(()=>{window.location.reload()})}):J(e,t)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}X.render(i(A.StrictMode,{children:i(ce,{})}),document.getElementById("root"));ue();
